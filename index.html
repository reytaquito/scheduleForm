<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScheduleForm</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

</head>

<body>
    <div id="form-container">
        <div class="form-step" id="step-1" style="display: block; ">
            <p id="error-message" style="display:none;color:rgb(245, 0, 0); margin-top: 0px; margin-bottom: 10px;"></p>

            <label for="email">Email*</label> <br>
            <input type="email" id="email" name="email" placeholder="Membership Email"> <br>
            <label for="phone">Phone Number*</label> <br>
            <input type="text" class="form-control" id="phone" name="phone" placeholder="Phone"> <br>
            <p id="blueT">Select a day and time for ALL YOUR PICKUPS:</p>
            <p>Recurring Pickup Day*</p>
            <select id="pickup-day">
                <option value=""></option>

            </select>
            <p>Recurring Pickup Window*</p>
            <select id="pickup-time">
                <option value=""></option>
                <option value="8-9">8am-9am</option>
                <option value="9-10">9am-10am</option>
                <option value="10-11">10am-11am</option>
            </select> <br>
            <div class="button-wrapper">
                <button class="next-btn">Next</button>
            </div>
        </div>
        <div class="form-step" id="step-2" style="display: none; ">
            <p id="error-message-2" style="display:none;color:red"></p>
            <p id="blueT">Select a day and time for ALL YOUR DELIVERIES:</p>
            <p id="steP2">*Note: Please select a Delivery Day at least 2 days after your Pickup Day. 24hrs Coming soon!
            </p>
            <p>Recurring Delivery Day *</p>
            <select id="delivery-day">
                <option value=""></option>
            </select>
            <p>Recurring Delivery Window *</p>
            <select id="delivery-time">
                <option value=""></option>
                <option value="2-3">2pm-3pm</option>
                <option value="3-4">3pm-4pm</option>
                <option value="4-5">4pm-5pm</option>
            </select> <br>
            <div class="button-wrapper">
                <button class="back-btn">Back</button>
                <button class="next-btn">Next</button>
            </div>
        </div>
        <div class="form-step" id="step-3" style="display: none;">
            <div id="error-message-3" style="color: red;"></div>
            <h2>Pickup Address</h2>
            <form>
                <label for="pickup-address-line-1">Address Line 1 *</label><br>
                <input type="text" id="pickup-address-line-1"><br>
                <label for="pickup-address-line-2">Address Line 2</label><br>
                <input type="text" id="pickup-address-line-2"><br>
                <label for="pickup-city">City *</label><br>
                <input type="text" id="pickup-city"><br>
                <label for="pickup-state">State *</label><br>
                <input type="text" id="pickup-state"><br>
                <label for="pickup-zip">Zip Code *</label><br>



                <div class="ui-widget">
                    <input id="pickup-zip" type="tel" maxlength="5">
                </div>


                <div class="hiddeInfo">
                    <label for="same-as-pickup">The same delivery address?</label><br>
                    <div style="display: flex; align-items: center;">
                        <input type="checkbox" id="same-as-pickup" style="height: 20px; width: 30px;"> Same As
                        Pickup<br>
                    </div>
                </div>
                <div class="notifyMe" style="display: none; margin-top: -10px;">
                    <button style="margin: 15px 0px;" class="notifyMe">Notify Me</button>
                    <p class="consent-msg">*By clicking this button, you agree to receive email
                        communications from Goldtux</p>
                </div>
            </form>
            <div class="hiddeInfo">
                <div class="button-wrapper">
                    <button class="back-btn">Back</button>
                    <button class="next-btn">Next</button>
                </div>
            </div>
        </div>
        <div class="form-step" id="step-4" style="display: none; ">
            <div id="error-message-4" style="color: red;"></div>
            <h2>Delivery Address</h2>
            <form>
                <label for="delivery-address-line-1">Address Line 1 *</label><br>
                <input type="text" id="delivery-address-line-1"><br>
                <label for="delivery-address-line-2">Address Line 2</label><br>
                <input type="text" id="delivery-address-line-2"><br>
                <label for="delivery-city">City *</label><br>
                <input type="text" id="delivery-city"><br>
                <label for="delivery-state">State *</label><br>
                <input type="text" id="delivery-state"><br>

                <label for="delivery-zip">Zip Code *</label><br>

                <div class="ui-widget">
                    <input id="delivery-zip" type="tel" maxlength="5">
                </div>

                <div class="notifyMe" style="display: none; margin-top: -10px!important;">
                    <button style="margin: 15px 0px;" class="notifyMe">Notify Me</button>
                    <p class="consent-msg">*By clicking this button, you agree to receive email
                        communications from Goldtux</p>
                </div>
            </form>
            <div class="hiddeInfo">
                <div class="button-wrapper">
                    <button class="back-btn">Back</button>
                    <button class="next-btn">Next</button>
                </div>
            </div>
        </div>
        <div class="form-step" id="step-5" style="display: none; ">
            <h4>Any Additional Information?</h4>
            <textarea id="additional-info"
                placeholder="Gate code, pickup instructions, special request (no crest, no starch, fold pants, etc.)"
                rows="6" cols="40"
                style="resize: none; background-color:#F7FAFC; border: none; padding: 4px;"></textarea><br>
            <div class="button-wrapper">
                <button class="back-btn">Back</button>
                <button id="submit-btn">Submit</button>
            </div>
            <div id="error-message-5" style="color:red; display:none;"></div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
        $(document).ready(function () {
            var currentStep = 1;

            // Map numbers to day names
            var days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

            var availableTags = [
                "33012", "33013", "33014", "33015", "33016", "33018", "33025", "33054", "33055", "33154", "33160", "33167", "33179"
            ];

            var isValidZip = true;
            $('#pickup-zip, #delivery-zip').keypress(function (e) {
                if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
                    return false;
                }
            }).on("input", function () {
                if ($(this).val().length > 5) {
                    $(this).val($(this).val().slice(0, 5));
                }
            });

            // Agregar funcionalidad de autocompletado
            $('#pickup-zip, #delivery-zip').autocomplete({
                source: availableTags
            });

            $('#pickup-zip, #delivery-zip').change(function () {
                var inputValue = $(this).val();
                // Remove any previous warning message
                $(".warning-msg").remove();
                if (!availableTags.includes(inputValue)) {
                    isValidZip = false; // set isValidZip to false
                    $(this).after('<p class="warning-msg" style="border-left: 7px solid red; padding: 10px; height: 5px; display: flex; align-items: center; color:red">Coming to your zip code soon!</p>');
                    // Hide divs with class 'hiddenInfo'
                    $('.hiddeInfo').hide();
                    $('.notifyMe').show();

                } else {
                    isValidZip = true; // set isValidZip to true
                    // Show divs with class 'hiddenInfo'
                    $('.hiddeInfo').show();
                    $('.notifyMe').hide();

                }
            });
            // When you press "Next", check if the zip is valid. If not, prevent moving to next step.
            $("#next-button").click(function (e) {
                if (!isValidZip) {
                    e.preventDefault(); // prevent default action, which in this case is the step transition
                    alert("Please enter a valid ZIP code."); // show a warning message
                }
            });
            // When you press "Next", check if the zip is valid. If not, prevent moving to next step.
            $("#next-button").click(function (e) {
                if (!isValidZip) {
                    e.preventDefault(); // prevent default action, which in this case is the step transition
                    // Remove any previous warning message on top of the form
                    $(".top-warning-msg").remove();
                    // Show the warning message on top of the form
                    $("#my-form").prepend('<p class="top-warning-msg" style="color:red;">Please enter a valid ZIP code.</p>');
                }
            });


            // Function to populate day dropdown
            function populateDayDropdown(dropdownId, selectedDayIndex, isDelivery) {
                if (isDelivery) {
                    var emptyOption = $('<option>', {
                        value: "",
                        text: "",
                    });
                    $('#' + dropdownId).append(emptyOption);
                }
                for (var i = 0; i < 9; i++) {
                    var dayIndex = (selectedDayIndex + i) % 7;
                    var dayName = days[dayIndex];
                    if (i == 8) {
                        dayName += " (Following week)"
                    }
                    var option = $('<option>', {
                        value: dayName,
                        text: dayName,
                        disabled: i < 2 // Disable the first 2 days
                    });
                    $('#' + dropdownId).append(option);
                }
            }
            // Populate the pickup day dropdown
            populateDayDropdown('pickup-day', (new Date()).getDay(), false);
            $('.next-btn').click(function () {
                var errorMessage = "";
                if (currentStep == 1) {
                    var email = $('#email').val();
                    var phone = $('#phone').val();
                    var pickupDay = $('#pickup-day').val();
                    var pickupTime = $('#pickup-time').val();
                    if (!phone) {
                        errorMessage += '<div style="border-left: 7px solid red; padding: 10px; height: 5px; display: flex; align-items: center;">&#8226; Phone number is required.<br/></div>';

                    } else if (!/^\d{10}$/.test(phone)) {
                        errorMessage += '<div style="border-left: 7px solid red; padding: 10px; height: 5px; display: flex; align-items: center;">&#8226; Please enter a valid phone number.<br/></div>';

                    }
                    if (!email) {
                        errorMessage += '<div style="border-left: 7px solid red; padding: 10px; height: 5px; display: flex; align-items: center;">&#8226; Email is required.<br/></div>';
                    } else if (!/^\S+@\S+\.\S+$/.test(email)) {
                        errorMessage += '<div style="border-left: 7px solid red; padding: 10px; height: 5px; display: flex; align-items: center;">&#8226; Please enter a valid email.<br/></div>';
                    }
                    if (!pickupDay) {
                        errorMessage += '<div style="border-left: 7px solid red; padding: 10px; height: 5px; display: flex; align-items: center;">&#8226; Pickup day is required.<br/></div>';
                    }
                    if (!pickupTime) {
                        errorMessage += '<div style="border-left: 7px solid red; padding: 10px; height: 5px; display: flex; align-items: center;">&#8226; Pickup time is required.<br/></div>';
                    }
                    if (errorMessage) {
                        $('#error-message').html(errorMessage).show();
                        return;
                    } else {
                        $('#error-message').hide();
                        // Populate the delivery day dropdown based on the pickup day selection
                        var selectedPickupDayIndex = days.indexOf(pickupDay);
                        $('#delivery-day').empty();
                        populateDayDropdown('delivery-day', selectedPickupDayIndex, true);
                    }
                }
                else if (currentStep == 2) {
                    var deliveryDay = $('#delivery-day').val();
                    var deliveryTime = $('#delivery-time').val();
                    if (!deliveryDay) {
                        errorMessage += '<div style="border-left: 7px solid red; padding: 10px; height: 5px; display: flex; align-items: center;">&#8226; Delivery day is required.<br/></div>';
                    }
                    if (!deliveryTime) {
                        errorMessage += '<div style="border-left: 7px solid red; padding: 10px; height: 5px; display: flex; align-items: center;">&#8226; Delivery time is required.<br/></div>';
                    }
                    if (errorMessage) {
                        $('#error-message-2').html(errorMessage).show();
                        return;
                    } else {
                        $('#error-message-2').hide();
                    }
                }
                else if (currentStep == 3) {
                    var pickupAddressLine1 = $('#pickup-address-line-1').val();
                    var pickupCity = $('#pickup-city').val();
                    var pickupState = $('#pickup-state').val();
                    var pickupZip = $('#pickup-zip').val();
                    if (!pickupAddressLine1) {
                        errorMessage += '<div style="border-left: 7px solid red; padding: 10px; height: 5px; display: flex; align-items: center;">&#8226; Address Line 1 is required.<br/></div>';
                    }
                    if (!pickupCity) {
                        errorMessage += '<div style="border-left: 7px solid red; padding: 10px; height: 5px; display: flex; align-items: center;">&#8226; City is required.<br/></div>';

                    }
                    if (!pickupState) {
                        errorMessage += '<div style="border-left: 7px solid red; padding: 10px; height: 5px; display: flex; align-items: center;">&#8226; State is required.<br/></div>';
                    }
                    if (!pickupZip) {
                        errorMessage += '<div style="border-left: 7px solid red; padding: 10px; height: 5px; display: flex; align-items: center;">&#8226; Zip Code is required.<br/></div>';

                    }
                    if (errorMessage) {
                        $('#error-message-3').html(errorMessage).show();
                        return;
                    } else {
                        $('#error-message-3').hide();
                    }
                }
                else if (currentStep == 4) {
                    var deliveryAddressLine1 = $('#delivery-address-line-1').val();
                    var deliveryCity = $('#delivery-city').val();
                    var deliveryState = $('#delivery-state').val();
                    var deliveryZip = $('#delivery-zip').val();
                    if (!deliveryAddressLine1) {
                        errorMessage += '<div style="border-left: 7px solid red; padding: 10px; height: 5px; display: flex; align-items: center;">&#8226; Address Line 1 is required.<br/></div>';

                    }
                    if (!deliveryCity) {
                        errorMessage += '<div style="border-left: 7px solid red; padding: 10px; height: 5px; display: flex; align-items: center;">&#8226; City is required.<br/></div>';

                    }
                    if (!deliveryState) {
                        errorMessage += '<div style="border-left: 7px solid red; padding: 10px; height: 5px; display: flex; align-items: center;">&#8226; State is required.<br/></div>';
                    }
                    if (!deliveryZip) {
                        errorMessage += '<div style="border-left: 7px solid red; padding: 10px; height: 5px; display: flex; align-items: center;">&#8226; Zip Code is required.<br/></div>';
                    }
                    if (errorMessage) {
                        $('#error-message-4').html(errorMessage).show();
                        return;
                    } else {
                        $('#error-message-4').hide();
                    }
                }
                if (currentStep == 3) {
                    var sameAsPickup = $('#same-as-pickup').is(':checked');
                    if (sameAsPickup) {
                        var pickupAddressLine1 = $('#pickup-address-line-1').val();
                        var pickupAddressLine2 = $('#pickup-address-line-2').val();
                        var pickupCity = $('#pickup-city').val();
                        var pickupState = $('#pickup-state').val();
                        var pickupZip = $('#pickup-zip').val();
                        $('#delivery-address-line-1').val(pickupAddressLine1);
                        $('#delivery-address-line-2').val(pickupAddressLine2);
                        $('#delivery-city').val(pickupCity);
                        $('#delivery-state').val(pickupState);
                        $('#delivery-zip').val(pickupZip);
                        if (currentStep < 5) {
                            $('#step-' + currentStep).hide();
                            currentStep += 2; // Skip step 4
                            $('#step-' + currentStep).show();
                        }
                        return;
                    }
                }
                if (currentStep < 5) {
                    $('#step-' + currentStep).hide();
                    currentStep += 1;
                    $('#step-' + currentStep).show();
                }
            });
            $('.back-btn').click(function () {
                if (currentStep > 1) {
                    $('#step-' + currentStep).hide();
                    currentStep -= 1;
                    $('#step-' + currentStep).show();
                    if (currentStep === 5) {
                        // Change 'Next' button back to 'Submit'
                        $('#next-btn').attr('id', 'submit-btn').text('Submit');
                    }
                }
            });
        });
        $("#submit-btn").click(function () {
            // Collect form data
            var formData = {
                email: $('#email').val(),
                phone: $('#phone').val(),
                pickupDay: $('#pickup-day').val(),
                pickupTime: $('#pickup-time').val(),
                deliveryDay: $('#delivery-day').val(),
                deliveryTime: $('#delivery-time').val(),
                pickupAddressLine1: $('#pickup-address-line-1').val(),
                pickupAddressLine2: $('#pickup-address-line-2').val(),
                pickupCity: $('#pickup-city').val(),
                pickupState: $('#pickup-state').val(),
                pickupZip: $('#pickup-zip').val(),
                deliveryAddressLine1: $('#delivery-address-line-1').val(),
                deliveryAddressLine2: $('#delivery-address-line-2').val(),
                deliveryCity: $('#delivery-city').val(),
                deliveryState: $('#delivery-state').val(),
                deliveryZip: $('#delivery-zip').val(),
                additionalInfo: $('#additional-info').val(),
            };
            console.log(JSON.stringify(formData))
            // Send form data to the server
            $.ajax({
                type: 'POST',
                url: 'your-server-url',
                data: JSON.stringify(formData),
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (response) {
                    // Handle successful response
                    alert('Form submitted successfully!');
                },
                error: function (error) {
                    // Handle error response
                    $('#error-message-5').html('There was an error submitting the form. Please try again.').show();
                }
            });
        });
    </script>
</body>

</html>